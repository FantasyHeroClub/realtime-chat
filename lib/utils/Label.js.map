{"version":3,"sources":["../../src/utils/Label.js"],"names":["makeLabelFormatters","checkLabelsDistinct","checkRangesOverlap","countRangeOverlaps","getLabelXRange","getLabelYRange","getLabelXOverhang","getLabelsXOverhang","getLabelsYOverhang","formatStrs","scaleType","map","isString","formatStr","v","format","labels","labelStrs","uniq","length","a","b","every","isArray","r","isFinite","Error","ranges","tail","reduce","sum","range","i","prevRange","scale","label","anchor","anchorOffsets","start","middle","end","x1","value","width","top","bottom","y1","height","labelLeft","labelRight","overhangLeft","Math","ceil","max","min","overhangRight","getLabelYOverhang","labelTop","labelBottom","overhangTop","overhangBottom","left","right","thisLeft","thisRight","thisTop","thisBottom"],"mappings":"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","file":"Label.js","sourcesContent":["import _ from 'lodash';\nimport moment from 'moment';\nimport numeral from 'numeral';\n\nexport function makeLabelFormatters(formatStrs, scaleType) {\n  return formatStrs.map(formatStr => {\n    if(!_.isString(formatStr)) return formatStr;\n    return (scaleType === 'time') ?\n      (v) => moment(v).format(formatStr) :\n      (v) => numeral(v).format(formatStr);\n  })\n}\n\nexport function checkLabelsDistinct(labels) {\n  // given a set of label objects with text properties,\n  // return true iff each label has distinct text (ie. no duplicate label texts)\n  const labelStrs = _.map(labels, 'text');\n  return (_.uniq(labelStrs).length === labelStrs.length);\n}\n\nexport function checkRangesOverlap(a, b) {\n  // given two number or date ranges of the form [start, end],\n  // returns true if the ranges overlap\n  if(!_.every([a, b], r => _.isArray(r) && r.length === 2 && _.every(r, _.isFinite) && r[0] <= r[1]))\n    throw new Error('checkRangesOverlap expects 2 range arrays with 2 numbers each, first <= second');\n\n  return a[0] <= b[1] && b[0] <= a[1];\n}\n\nexport function countRangeOverlaps(ranges) {\n  // given a list of ranges of the form [[start, end], ...]\n  // counts the number of adjacent ranges which touch or overlap each other\n  // todo: instead of counting overlaps, sum the amount by which they overlap & choose least overlap\n\n  return _.tail(ranges).reduce((sum, range, i) => {\n    const prevRange = ranges[i]; // (not [i-1], _.tail skips first range)\n    return checkRangesOverlap(prevRange, range) ? sum + 1 : sum;\n  }, 0)\n}\n\nexport function getLabelXRange(scale, label, anchor = 'middle') {\n  const anchorOffsets = {start: 0, middle: -0.5, end: -1};\n  const x1 = scale(label.value) + ((anchorOffsets[anchor] || 0) * label.width);\n  return [x1, x1 + label.width];\n}\n\nexport function getLabelYRange(scale, label, anchor = 'middle') {\n  const anchorOffsets = {top: 0, middle: -0.5, bottom: -1};\n  const y1 = scale(label.value) + ((anchorOffsets[anchor] || 0) * label.height);\n  return [y1, y1 + label.height];\n}\n\nexport function getLabelXOverhang(scale, label, anchor = 'middle') {\n  const [labelLeft, labelRight] = getLabelXRange(scale, label, anchor);\n  const overhangLeft = Math.ceil(Math.max(_.min(scale.range()) - labelLeft, 0));\n  const overhangRight = Math.ceil(Math.max(labelRight - _.max(scale.range()), 0));\n  return [overhangLeft, overhangRight];\n}\n\nfunction getLabelYOverhang(scale, label, anchor = 'middle') {\n  const [labelTop, labelBottom] = getLabelYRange(scale, label, anchor);\n  const overhangTop = Math.ceil(Math.max(_.min(scale.range()) - labelTop, 0));\n  const overhangBottom = Math.ceil(Math.max(labelBottom - _.max(scale.range()), 0));\n  return [overhangTop, overhangBottom];\n}\n\nexport function getLabelsXOverhang(scale, labels, anchor = 'middle') {\n  return _.reduce(labels, ([left, right], label) => {\n    const [thisLeft, thisRight] = getLabelXOverhang(scale, label, anchor);\n    return [Math.max(left, thisLeft), Math.max(right, thisRight)];\n  }, [0, 0]);\n}\n\nexport function getLabelsYOverhang(scale, labels, anchor = 'middle') {\n  return _.reduce(labels, ([top, bottom], label) => {\n    const [thisTop, thisBottom] = getLabelYOverhang(scale, label, anchor);\n    return [Math.max(top, thisTop), Math.max(bottom, thisBottom)];\n  }, [0, 0]);\n}\n\n\n\n"]}